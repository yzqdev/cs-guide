import{_ as s,c as a,a as p,o as t}from"./app-B6vXTniy.js";const e={};function l(o,n){return t(),a("div",null,[...n[0]||(n[0]=[p(`<h1 id="vite-config-js" tabindex="-1"><a class="header-anchor" href="#vite-config-js"><span>vite.config.js</span></a></h1><div class="hint-container tip"><p class="hint-container-title">提示</p><p>vite官网说的很不错了 <a href="https://vitejs.dev/" target="_blank" rel="noopener noreferrer">https://vitejs.dev/</a></p></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> resolve <span class="token operator">=</span> path<span class="token punctuation">.</span>resolve<span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-vue&#39;</span></span>
<span class="line"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&quot;path&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">//导入时想要省略的扩展名列表。注意，不 建议忽略自定义导入类型的扩展名（例如：.vue），因为它会干扰 IDE 和类型支持。</span></span>
<span class="line">    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@views&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">replacement</span><span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src/views&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span></span>
<span class="line">        <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@components&quot;</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token literal-property property">replacement</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src/components&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">find</span><span class="token operator">:</span> <span class="token string">&quot;@utils&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">replacement</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./src/utils&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// sourcemap: true,</span></span>
<span class="line">    <span class="token literal-property property">minify</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">server</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">3600</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>import.meta.glob 为过动态导入，构建时，会分离为独立的 chunk</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">glob</span><span class="token punctuation">(</span><span class="token string">&#39;./module/*.js&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    files<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span></span>
<span class="line">        modules<span class="token punctuation">[</span>key<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex"><span class="token group punctuation">(</span><span class="token special-escape escape">\\.</span><span class="token escape">\\/</span>module<span class="token escape">\\/</span><span class="token alternation keyword">|</span><span class="token special-escape escape">\\.</span>js<span class="token group punctuation">)</span></span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">.</span>default</span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>modules<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    modules<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;namespaced&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">//import.meta.globEager 为直接引入</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> files <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token function">globEager</span><span class="token punctuation">(</span><span class="token string">&#39;./module/*.js&#39;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></span>
<span class="line"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> files<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    modules<span class="token punctuation">[</span>key<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex"><span class="token group punctuation">(</span><span class="token special-escape escape">\\.</span><span class="token escape">\\/</span>module<span class="token escape">\\/</span><span class="token alternation keyword">|</span><span class="token special-escape escape">\\.</span>js<span class="token group punctuation">)</span></span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">&#39;&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> files<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>default</span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>modules<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    modules<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&#39;namespaced&#39;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="打包分离js和css" tabindex="-1"><a class="header-anchor" href="#打包分离js和css"><span>打包分离js和css</span></a></h2><h3 id="只是分离vendor和文件路径" tabindex="-1"><a class="header-anchor" href="#只是分离vendor和文件路径"><span>只是分离vendor和文件路径</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span></span>
<span class="line"><span class="token keyword">import</span> react <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-react&#39;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// https://vitejs.dev/config/</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  esbuild<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    drop<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;console&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;debugger&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  build<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    </span>
<span class="line">    target<span class="token operator">:</span> <span class="token string">&quot;es2020&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">// minify: &quot;terser&quot;,</span></span>
<span class="line">    <span class="token comment">// rollup 配置</span></span>
<span class="line">    rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      output<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        chunkFileNames<span class="token operator">:</span> <span class="token string">&quot;js/[name]-[hash].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 引入文件名的名称</span></span>
<span class="line">        entryFileNames<span class="token operator">:</span> <span class="token string">&quot;js/[name]-[hash].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 包的入口文件名称</span></span>
<span class="line">        assetFileNames<span class="token operator">:</span> <span class="token string">&quot;[ext]/[name]-[hash].[ext]&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 资源文件像 字体，图片等</span></span>
<span class="line">        <span class="token function">manualChunks</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token string">&quot;vendor&quot;</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// terserOptions: {</span></span>
<span class="line">    <span class="token comment">//   compress: {</span></span>
<span class="line">    <span class="token comment">//     // 生产环境时移除console</span></span>
<span class="line">    <span class="token comment">//     drop_console: true,</span></span>
<span class="line">    <span class="token comment">//     drop_debugger: true,</span></span>
<span class="line">    <span class="token comment">//   },</span></span>
<span class="line">    <span class="token comment">// },</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="code-split" tabindex="-1"><a class="header-anchor" href="#code-split"><span>code split</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span></span>
<span class="line"><span class="token keyword">import</span> react <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-react&#39;</span></span>
<span class="line"><span class="token keyword">const</span> dev<span class="token operator">=</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token operator">===</span><span class="token string">&#39;development&#39;</span></span>
<span class="line"><span class="token comment">// https://vitejs.dev/config/</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  esbuild<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    drop<span class="token operator">:</span> dev <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;console&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;debugger&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  build<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    target<span class="token operator">:</span> <span class="token string">&quot;es2020&quot;</span><span class="token punctuation">,</span></span>
<span class="line">     </span>
<span class="line">    rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      output<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        chunkFileNames<span class="token operator">:</span> <span class="token string">&quot;js/[name]-[hash].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 引入文件名的名称</span></span>
<span class="line">        entryFileNames<span class="token operator">:</span> <span class="token string">&quot;js/[name]-[hash].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 包的入口文件名称</span></span>
<span class="line">        assetFileNames<span class="token operator">:</span> <span class="token string">&quot;[ext]/[name]-[hash].[ext]&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 资源文件像 字体，图片等</span></span>
<span class="line">        <span class="token function">manualChunks</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&quot;node_modules&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">           <span class="token keyword">const</span> arr <span class="token operator">=</span> id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;node_modules/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">           <span class="token keyword">switch</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">             <span class="token keyword">case</span> <span class="token string">&quot;antd&quot;</span><span class="token operator">:</span> <span class="token comment">// 自然框架</span></span>
<span class="line">             <span class="token keyword">case</span> <span class="token string">&quot;react&quot;</span><span class="token operator">:</span></span>
<span class="line">             <span class="token keyword">case</span> <span class="token string">&quot;react-dom&quot;</span><span class="token operator">:</span></span>
<span class="line">             <span class="token keyword">case</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token operator">:</span> <span class="token comment">// UI 库</span></span>
<span class="line">           </span>
<span class="line">               <span class="token keyword">return</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">+</span> arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">               <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">             <span class="token keyword">default</span><span class="token operator">:</span></span>
<span class="line">               <span class="token keyword">return</span> <span class="token string">&quot;__vendor&quot;</span><span class="token punctuation">;</span></span>
<span class="line">               <span class="token keyword">break</span><span class="token punctuation">;</span></span>
<span class="line">           <span class="token punctuation">}</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        </span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line"> </span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="另一种code-split的方法-根据package-json中的dependencies" tabindex="-1"><a class="header-anchor" href="#另一种code-split的方法-根据package-json中的dependencies"><span>另一种code split的方法(根据package.json中的dependencies)</span></a></h3><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span></span>
<span class="line"><span class="token keyword">import</span> react <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-react&#39;</span></span>
<span class="line"><span class="token keyword">const</span> dev<span class="token operator">=</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token operator">===</span><span class="token string">&#39;development&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> dependencies <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./package.json&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> globalVendorPackages <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;react-router-dom&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">renderChunks</span><span class="token punctuation">(</span>deps<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> chunks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>deps<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>globalVendorPackages<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    chunks<span class="token punctuation">[</span>key<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;_&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&#39;@&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;_&#39;</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> chunks<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"> </span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  esbuild<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    drop<span class="token operator">:</span> dev <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;console&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;debugger&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  build<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    target<span class="token operator">:</span> <span class="token string">&quot;es2020&quot;</span><span class="token punctuation">,</span></span>
<span class="line">     </span>
<span class="line">    rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      output<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        chunkFileNames<span class="token operator">:</span> <span class="token string">&quot;js/[name]-[hash].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 引入文件名的名称</span></span>
<span class="line">        entryFileNames<span class="token operator">:</span> <span class="token string">&quot;js/[name]-[hash].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 包的入口文件名称</span></span>
<span class="line">        assetFileNames<span class="token operator">:</span> <span class="token string">&quot;[ext]/[name]-[hash].[ext]&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 资源文件像 字体，图片等</span></span>
<span class="line">        manualChunks <span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          vendor<span class="token operator">:</span> globalVendorPackages<span class="token punctuation">,</span></span>
<span class="line">          <span class="token operator">...</span><span class="token function">renderChunks</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">        </span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line"> </span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>还有一种简单的方法</p><div class="language-typescript" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line">  build<span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">     rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">            output<span class="token operator">:</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token function">manualChunks</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                    <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">                        <span class="token keyword">return</span> id<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;node_modules/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">                    <span class="token punctuation">}</span></span>
<span class="line">                <span class="token punctuation">}</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"></span></code></pre></div><h2 id="vite配置" tabindex="-1"><a class="header-anchor" href="#vite配置"><span>vite配置</span></a></h2><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"></span>
<span class="line"><span class="token comment">// vite.config.js</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> createHtmlPlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-html&#39;</span></span>
<span class="line"><span class="token keyword">import</span> viteImagemin <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-imagemin&#39;</span></span>
<span class="line"><span class="token keyword">import</span> externalGlobals <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-external-globals&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> visualizer <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;rollup-plugin-visualizer&#39;</span></span>
<span class="line"><span class="token keyword">import</span> viteCompression <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-compression&#39;</span></span>
<span class="line"><span class="token comment">// https://vitejs.dev/config/</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  plugins<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token function">visualizer</span><span class="token punctuation">(</span><span class="token punctuation">{</span> open<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">// 将下面的添加到plugin下</span></span>
<span class="line">    <span class="token function">createHtmlPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      minify<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">      inject<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        data<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          vuescript<span class="token operator">:</span> <span class="token string">&#39;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/vue@3.2.25&quot;&gt;&lt;/script&gt;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          demiScript<span class="token operator">:</span> <span class="token string">&#39;&lt;script src=&quot;//cdn.jsdelivr.net/npm/vue-demi@0.13.7&quot;&gt;&lt;/script&gt;&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          elementPlusScript<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string"></span>
<span class="line">            &lt;link href=&quot;https://cdn.jsdelivr.net/npm/element-plus@2.2.22/dist/index.min.css&quot; rel=&quot;stylesheet&quot;&gt;</span>
<span class="line">            &lt;script src=&quot;https://cdn.jsdelivr.net/npm/element-plus@2.2.22/dist/index.full.min.js&quot;&gt;&lt;/script&gt;</span>
<span class="line">          </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">          echartsSciprt<span class="token operator">:</span> <span class="token string">&#39;&lt;script src=&quot;https://cdn.jsdelivr.net/npm/echarts@5.0.2/dist/echarts.min.js&quot;&gt;&lt;/script&gt;&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">viteImagemin</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      gifsicle<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        optimizationLevel<span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span></span>
<span class="line">        interlaced<span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      optipng<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        optimizationLevel<span class="token operator">:</span> <span class="token number">7</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      mozjpeg<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        quality<span class="token operator">:</span> <span class="token number">20</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      pngquant<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        quality<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.9</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">        speed<span class="token operator">:</span> <span class="token number">4</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      svgo<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        plugins<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            name<span class="token operator">:</span> <span class="token string">&#39;removeViewBox&#39;</span></span>
<span class="line">          <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token punctuation">{</span></span>
<span class="line">            name<span class="token operator">:</span> <span class="token string">&#39;removeEmptyAttrs&#39;</span><span class="token punctuation">,</span></span>
<span class="line">            active<span class="token operator">:</span> <span class="token boolean">false</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">]</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  build<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    target<span class="token operator">:</span> <span class="token string">&#39;es2020&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    minify<span class="token operator">:</span> <span class="token string">&#39;terser&#39;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token comment">// rollup 配置</span></span>
<span class="line">    rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      output<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        chunkFileNames<span class="token operator">:</span> <span class="token string">&#39;js/[name]-[hash].js&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 引入文件名的名称</span></span>
<span class="line">        entryFileNames<span class="token operator">:</span> <span class="token string">&#39;js/[name]-[hash].js&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 包的入口文件名称</span></span>
<span class="line">        assetFileNames<span class="token operator">:</span> <span class="token string">&#39;[ext]/[name]-[hash].[ext]&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 资源文件像 字体，图片等</span></span>
<span class="line">        <span class="token function">manualChunks</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">if</span> <span class="token punctuation">(</span>id<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span><span class="token string">&#39;node_modules&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">            <span class="token keyword">return</span> <span class="token string">&#39;vendor&#39;</span></span>
<span class="line">          <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token comment">//  告诉打包工具 在external配置的 都是外部依赖项  不需要打包</span></span>
<span class="line">      external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;vue&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;element-plus&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;echarts&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">      plugins<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">        <span class="token function">externalGlobals</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          vue<span class="token operator">:</span> <span class="token string">&#39;Vue&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string-property property">&#39;element-plus&#39;</span><span class="token operator">:</span> <span class="token string">&#39;ElementPlus&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          echarts<span class="token operator">:</span> <span class="token string">&#39;echarts&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          <span class="token string-property property">&#39;vue-demi&#39;</span><span class="token operator">:</span> <span class="token string">&#39;VueDemi&#39;</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token function">viteCompression</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">          verbose<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否在控制台中输出压缩结果</span></span>
<span class="line">          disable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></span>
<span class="line">          threshold<span class="token operator">:</span> <span class="token number">10240</span><span class="token punctuation">,</span> <span class="token comment">// 如果体积大于阈值，将被压缩，单位为b，体积过小时请不要压缩，以免适得其反</span></span>
<span class="line">          algorithm<span class="token operator">:</span> <span class="token string">&#39;gzip&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 压缩算法，可选[&#39;gzip&#39;，&#39; brotliccompress &#39;，&#39;deflate &#39;，&#39;deflateRaw&#39;]</span></span>
<span class="line">          ext<span class="token operator">:</span> <span class="token string">&#39;.gz&#39;</span><span class="token punctuation">,</span></span>
<span class="line">          deleteOriginFile<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 源文件压缩后是否删除</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">      <span class="token punctuation">]</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    terserOptions<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      compress<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token comment">// 生产环境时移除console</span></span>
<span class="line">        drop_console<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">        drop_debugger<span class="token operator">:</span> <span class="token boolean">true</span></span>
<span class="line">      <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用cdn实例" tabindex="-1"><a class="header-anchor" href="#使用cdn实例"><span>使用cdn实例</span></a></h2><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite&#39;</span></span>
<span class="line"><span class="token keyword">import</span> react <span class="token keyword">from</span> <span class="token string">&#39;@vitejs/plugin-react&#39;</span></span>
<span class="line"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&#39;node:path&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> dependencies <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./package.json&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span> vitePluginForArco <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@arco-plugins/vite-react&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>cdn<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-cdn2&#39;</span></span>
<span class="line"><span class="token keyword">import</span> <span class="token punctuation">{</span>unpkg<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;vite-plugin-cdn2/url.js&#39;</span></span>
<span class="line"><span class="token keyword">const</span> globalVendorPackages <span class="token operator">=</span> <span class="token punctuation">[</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//[&#39;react&#39;, &#39;react-dom&#39;, &#39;react-router-dom&#39;]</span></span>
<span class="line"><span class="token keyword">const</span> externalPackages <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="line">  <span class="token string">&quot;react&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;react-dom&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token string">&quot;axios&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  </span>
<span class="line"><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">renderChunks</span><span class="token punctuation">(</span>deps<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">let</span> chunks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line">  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>deps<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>globalVendorPackages<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>externalPackages<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span></span>
<span class="line">    chunks<span class="token punctuation">[</span>key<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;@&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">return</span> chunks<span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token comment">// https://vitejs.dev/config/</span></span>
<span class="line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  plugins<span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token function">react</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">vitePluginForArco</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">      style<span class="token operator">:</span> <span class="token string">&quot;css&quot;</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token function">cdn</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">       url<span class="token operator">:</span> unpkg<span class="token punctuation">,</span></span>
<span class="line">      modules<span class="token operator">:</span> externalPackages<span class="token punctuation">,</span></span>
<span class="line"></span>
<span class="line">      <span class="token function">resolve</span><span class="token punctuation">(</span>baseURL<span class="token punctuation">,</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> version<span class="token punctuation">,</span> relativeModule <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        </span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token operator">==</span><span class="token string">&#39;axios&#39;</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">return</span> <span class="token string">&quot;https://unpkg.com/axios@1.6.0/dist/axios.min.js&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">        <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">          <span class="token keyword">const</span> ur <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name"><span class="token constant">URL</span></span><span class="token punctuation">(</span></span>
<span class="line">            <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>version<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>relativeModule<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span></span>
<span class="line">            baseURL</span>
<span class="line">          <span class="token punctuation">)</span><span class="token punctuation">.</span>href<span class="token punctuation">;</span></span>
<span class="line">          <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ur<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">          <span class="token keyword">return</span> ur<span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  build<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    rollupOptions<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      external<span class="token operator">:</span> externalPackages<span class="token punctuation">,</span></span>
<span class="line">      output<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">        chunkFileNames<span class="token operator">:</span> <span class="token string">&quot;js/[name].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 引入文件名的名称</span></span>
<span class="line">        entryFileNames<span class="token operator">:</span> <span class="token string">&quot;js/[name].js&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 包的入口文件名称</span></span>
<span class="line">        assetFileNames<span class="token operator">:</span> <span class="token string">&quot;[ext]/[name].[ext]&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 资源文件像 字体，图片等</span></span>
<span class="line">        manualChunks<span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">          vendor<span class="token operator">:</span> globalVendorPackages<span class="token punctuation">,</span></span>
<span class="line">          <span class="token operator">...</span><span class="token function">renderChunks</span><span class="token punctuation">(</span>dependencies<span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://github.com/antfu/vite-plugin-inspect" target="_blank" rel="noopener noreferrer">https://github.com/antfu/vite-plugin-inspect</a></p>`,19)])])}const i=s(e,[["render",l]]),u=JSON.parse('{"path":"/frontend/framework/packaging-tool/vite-tutor/vite-configs.html","title":"vite.config.js","lang":"zh-CN","frontmatter":{"description":"vite.config.js 提示 vite官网说的很不错了 https://vitejs.dev/ import.meta.glob 为过动态导入，构建时，会分离为独立的 chunk 打包分离js和css 只是分离vendor和文件路径 code split 另一种code split的方法(根据package.json中的dependencies)...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"vite.config.js\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-04-20T15:42:17.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"yzqdev\\",\\"url\\":\\"http://www.yzqdev.top\\"}]}"],["meta",{"property":"og:url","content":"https://yzqdev.github.io/cs-guide/cs-guide/frontend/framework/packaging-tool/vite-tutor/vite-configs.html"}],["meta",{"property":"og:site_name","content":"cs-guide"}],["meta",{"property":"og:title","content":"vite.config.js"}],["meta",{"property":"og:description","content":"vite.config.js 提示 vite官网说的很不错了 https://vitejs.dev/ import.meta.glob 为过动态导入，构建时，会分离为独立的 chunk 打包分离js和css 只是分离vendor和文件路径 code split 另一种code split的方法(根据package.json中的dependencies)..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-04-20T15:42:17.000Z"}],["meta",{"property":"article:modified_time","content":"2024-04-20T15:42:17.000Z"}]]},"git":{"createdTime":1687669238000,"updatedTime":1713627737000,"contributors":[{"name":"yzqdev","username":"yzqdev","email":"yzqdev@outlook.com","commits":3,"url":"https://github.com/yzqdev"}]},"readingTime":{"minutes":3.76,"words":1129},"filePathRelative":"frontend/framework/packaging-tool/vite-tutor/vite-configs.md","autoDesc":true}');export{i as comp,u as data};
