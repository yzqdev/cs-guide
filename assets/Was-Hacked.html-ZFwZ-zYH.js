import{_ as l,c as o,a as i,o as t}from"./app-B6vXTniy.js";const a={};function c(r,e){return t(),o("div",null,[...e[0]||(e[0]=[i(`<h1 id="黑客入侵检查" tabindex="-1"><a class="header-anchor" href="#黑客入侵检查"><span>黑客入侵检查</span></a></h1><hr><h2 id="思路" tabindex="-1"><a class="header-anchor" href="#思路"><span>思路</span></a></h2><ul><li>扫描木马工具：<code>clamAV</code><ul><li>官网：<a href="http://pkgs.repoforge.org/clamav/" target="_blank" rel="noopener noreferrer">http://pkgs.repoforge.org/clamav/</a></li></ul></li><li>CentOS 安装：<code>yum install -y clamav*</code></li><li>启动 clamAV 服务：<code>service clamd restart</code></li><li>更新病毒库：<code>freshclam</code></li><li>扫描方法： <ul><li>扫描 /etc 目录，并把扫描结果放在 /root 目录下：<code>clamscan -r /etc --max-dir-recursion=5 -l /root/etcclamav.log</code></li><li>扫描 /bin 目录，并把扫描结果放在 /root 目录下：<code>clamscan -r /bin --max-dir-recursion=5 -l /root/binclamav.log</code></li><li>扫描 /usr 目录，并把扫描结果放在 /root 目录下：<code>clamscan -r /usr --max-dir-recursion=5 -l /root/usrclamav.log</code></li></ul></li><li>如果日志有类似内容，表示有木马病毒： <ul><li><code>/usr/bin/.sshd: Linux.Trojan.Agent FOUND</code></li><li><code>/usr/sbin/ss: Linux.Trojan.Agent FOUND</code></li><li><code>/usr/sbin/lsof: Linux.Trojan.Agent FOUND</code></li></ul></li><li>看下当前有多少登录者：<code>who</code></li><li>看下最近有哪些登录者：<code>last</code></li><li>查看最近尝试登录的账号信息：<code>grep &quot;sshd&quot; /var/log/secure</code><ul><li>很多这种信息就表示有人在不断地尝试用 root 登录：<code>Failed password for root from 222.186.56.168 port 4080 ssh2</code></li></ul></li><li>查看最近登录成功的账号信息：<code>grep &quot;Accepted&quot; /var/log/secure</code>，可以看到：pop3, ssh, telnet, ftp 类型</li><li>看下查看系统资源占用有无异常：<code>top</code></li><li>看下所有进程：<code>ps aux</code></li><li>查看当前系统登录者有哪些，及其登录记录：<code>last | more</code></li><li>把最近执行的所有命令输出到一个文件，然后下载下来细细研究：<code>history &gt;&gt; /opt/test.txt</code></li><li>查看当前系统所有用户有哪些：<code>cat /etc/passwd |awk -F \\: &#39;{print $1}&#39;</code><ul><li>更多详细可以用：<code>cat /etc/passwd</code></li></ul></li><li>查看开放的端口，比如常用的80,22,8009，后面的箭头表示端口对应占用的程序：<code>netstat -lnp</code></li><li>检查某个端口的具体信息：<code>lsof -i :18954</code></li><li>检查启动项：<code>chkconfig</code></li><li>检查定时器（重要）：<code>cat /etc/crontab</code></li><li>检查定时器（重要）：<code>crontab -l</code><ul><li><code>vim /var/spool/cron/crontabs/root</code></li><li><code>vim /var/spool/cron/root</code></li></ul></li><li>检查其他系统重要文件： <ul><li><code>cat /etc/rc.local</code></li><li><code>cd /etc/init.d;ll</code></li></ul></li><li>检查文件： <ul><li><code>find / -uid 0 –perm -4000 –print</code></li><li><code>find / -size +10000k –print</code></li><li><code>find / -name &quot;…&quot; –print</code></li><li><code>find / -name &quot;.. &quot; –print</code></li><li><code>find / -name &quot;. &quot; –print</code></li><li><code>find / -name &quot; &quot; –print</code></li></ul></li><li>下载 iftop 分析流量，查看是否被黑客当做肉鸡使用</li><li>安装 iftop <ul><li>官网：<a href="http://www.ex-parrot.com/~pdw/iftop/" target="_blank" rel="noopener noreferrer">http://www.ex-parrot.com/~pdw/iftop/</a></li><li>使用文章：<a href="https://linux.cn/article-1843-1.html" target="_blank" rel="noopener noreferrer">https://linux.cn/article-1843-1.html</a></li><li>没有安装第三方源的情况： <ul><li>安装依赖包：<code>yum install -y flex byacc libpcap ncurses ncurses-devel libpcap-devel</code></li><li>下载源码包：<code>wget http://www.ex-parrot.com/pdw/iftop/download/iftop-0.17.tar.gz</code></li><li>解压：<code>tar zxf iftop-0.17.tar.gz</code></li><li>进入解压目录：<code>cd iftop-0.17/</code></li><li>编译：<code>./configure</code></li><li>安装：<code>make &amp;&amp; make install</code></li></ul></li><li>有第三方源的情况（eg：EPEL）： <ul><li><code>yum install -y iftop</code></li></ul></li></ul></li><li>运行：<code>iftop</code><ul><li>显示端口与 IP 信息：<code>iftop -nP</code></li></ul></li></ul><div class="language-nginx" data-highlighter="prismjs" data-ext="nginx"><pre><code class="language-nginx"><span class="line">中间部分：外部连接列表，即记录了哪些ip正在和本机的网络连接</span>
<span class="line"></span>
<span class="line">右边部分：实时参数分别是该访问 ip 连接到本机 2 秒，10 秒和 40 秒的平均流量</span>
<span class="line"></span>
<span class="line">=&gt; 代表发送数据，&lt;= 代表接收数据</span>
<span class="line"></span>
<span class="line">底部会显示一些全局的统计数据，peek 是指峰值情况，cumm 是从 iftop 运行至今的累计情况，而 rates 表示最近 2 秒、10 秒、40 秒内总共接收或者发送的平均网络流量。</span>
<span class="line"></span>
<span class="line">TX:（发送流量）  cumm:   143MB   peak:   10.5Mb    rates:   1.03Mb  1.54Mb  2.10Mb</span>
<span class="line">RX:（接收流量）          12.7GB          228Mb              189Mb   191Mb   183Mb</span>
<span class="line">TOTAL:（总的流量）       12.9GB          229Mb              190Mb   193Mb   185MbW</span>
<span class="line"></span>
<span class="line"></span></code></pre></div><ul><li>禁用 root 账号登录：<code>vim /etc/ssh/sshd_config</code><ul><li>把 PermitRootLogin 属性 yes 改为 no</li></ul></li><li>如果安全度要更高，可以考虑禁用口令登录，采用私钥/公钥方式：<code>vim /etc/ssh/sshd_config</code><ul><li>设置属性：PasswordAuthentication 为 no</li></ul></li><li>如果还要限制指定 IP 登录，可以考虑编辑：hosts.allow 和 hosts.deny 两个文件</li><li>重要系统软件更新（更新之前最好先做好系统镜像或是快照，以防万一）： <ul><li>yum update kernel</li><li>yum update kernel-devel</li><li>yum update kernel-firmware</li><li>yum update kernel-headers</li><li>yum update openssh</li><li>yum update openssh-clients</li><li>yum update openssh-server</li></ul></li></ul><h2 id="实战" tabindex="-1"><a class="header-anchor" href="#实战"><span>实战</span></a></h2><h4 id="挖矿程序" tabindex="-1"><a class="header-anchor" href="#挖矿程序"><span>挖矿程序</span></a></h4><ul><li>先查看调度任务是否有新增内容 <ul><li><code>vim /var/spool/cron/root</code></li><li><code>vim /var/spool/cron/crontabs/root</code></li></ul></li><li>如果有，先停止定时任务：<code>systemctl stop crond</code></li><li>如果对方有去 wget curl 指定网站，则先在 hosts 里面映射为 127.0.0.1，比如：<code>127.0.0.1 prax0zma.ru</code><ul><li>查看当前最占用 CPU 的进程 PID，加入发现是 22935，则：<code>cd /proc/22935 &amp;&amp; ll</code>，发现程序目录是：<code>/root/.tmp00/bash64</code></li><li>我们就把该程序去掉执行任务的权限：<code>chmod -R -x /root/.tmp00/</code>，然后再 kill 掉该程序</li></ul></li><li>打开别人的脚本，看下是如何书写的，发现有写入几个目录，这里进行删除：</li></ul><div class="language-text" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">rm -rf /tmp/.ha /boot/.b /boot/.0 /root/.tmp00</span>
<span class="line"></span></code></pre></div><ul><li>最后检查下是否有免密内容被修改：<code>cd ~/.ssh/ &amp;&amp; cat authorized_keys</code></li></ul><h2 id="资料" tabindex="-1"><a class="header-anchor" href="#资料"><span>资料</span></a></h2><ul><li><a href="http://www.jianshu.com/p/97b9dc47b88c" target="_blank" rel="noopener noreferrer">http://www.jianshu.com/p/97b9dc47b88c</a></li><li><a href="http://monklof.com/post/10/" target="_blank" rel="noopener noreferrer">http://monklof.com/post/10/</a></li><li><a href="http://yafeilee.me/blogs/54be6e876c69341430050000" target="_blank" rel="noopener noreferrer">http://yafeilee.me/blogs/54be6e876c69341430050000</a></li><li><a href="http://coolnull.com/4174.html" target="_blank" rel="noopener noreferrer">http://coolnull.com/4174.html</a></li><li><a href="http://www.oicqzone.com/pc/2014110420118.html" target="_blank" rel="noopener noreferrer">http://www.oicqzone.com/pc/2014110420118.html</a></li></ul>`,13)])])}const s=l(a,[["render",c]]),d=JSON.parse('{"path":"/linux-tutor/server/Was-Hacked.html","title":"黑客入侵检查","lang":"zh-CN","frontmatter":{"description":"黑客入侵检查 思路 扫描木马工具：clamAV 官网：http://pkgs.repoforge.org/clamav/ CentOS 安装：yum install -y clamav* 启动 clamAV 服务：service clamd restart 更新病毒库：freshclam 扫描方法： 扫描 /etc 目录，并把扫描结果放在 /root ...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"黑客入侵检查\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2022-05-27T01:37:35.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"yzqdev\\",\\"url\\":\\"http://www.yzqdev.top\\"}]}"],["meta",{"property":"og:url","content":"https://yzqdev.github.io/cs-guide/cs-guide/linux-tutor/server/Was-Hacked.html"}],["meta",{"property":"og:site_name","content":"cs-guide"}],["meta",{"property":"og:title","content":"黑客入侵检查"}],["meta",{"property":"og:description","content":"黑客入侵检查 思路 扫描木马工具：clamAV 官网：http://pkgs.repoforge.org/clamav/ CentOS 安装：yum install -y clamav* 启动 clamAV 服务：service clamd restart 更新病毒库：freshclam 扫描方法： 扫描 /etc 目录，并把扫描结果放在 /root ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2022-05-27T01:37:35.000Z"}],["meta",{"property":"article:modified_time","content":"2022-05-27T01:37:35.000Z"}]]},"git":{"createdTime":1653565176000,"updatedTime":1653615455000,"contributors":[{"name":"yzqdev","username":"yzqdev","email":"yzqdev@outlook.com","commits":3,"url":"https://github.com/yzqdev"}]},"readingTime":{"minutes":3.59,"words":1076},"filePathRelative":"linux-tutor/server/Was-Hacked.md","autoDesc":true}');export{s as comp,d as data};
