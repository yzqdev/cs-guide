import{_ as n,c as a,a as e,o as t}from"./app-C8DxhDIZ.js";const p={};function l(i,s){return t(),a("div",null,s[0]||(s[0]=[e(`<h1 id="pgsql的代码片段" tabindex="-1"><a class="header-anchor" href="#pgsql的代码片段"><span>pgsql的代码片段</span></a></h1><h2 id="删除所有的sequence" tabindex="-1"><a class="header-anchor" href="#删除所有的sequence"><span>删除所有的sequence</span></a></h2><div class="language-sql" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line">  </span>
<span class="line"><span class="token keyword">DO</span> $$  </span>
<span class="line"><span class="token keyword">DECLARE</span>  </span>
<span class="line">    seq_record RECORD<span class="token punctuation">;</span>  </span>
<span class="line"><span class="token keyword">BEGIN</span>  </span>
<span class="line">    <span class="token keyword">FOR</span> seq_record <span class="token operator">IN</span> <span class="token keyword">SELECT</span> sequence_name <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>sequences <span class="token keyword">where</span> table_schema<span class="token operator">=</span><span class="token string">&#39;public&#39;</span>  </span>
<span class="line">  </span>
<span class="line">    <span class="token keyword">LOOP</span>  </span>
<span class="line">         raise notice <span class="token string">&#39;当前seq %&#39;</span><span class="token punctuation">,</span>seq_record<span class="token punctuation">.</span>sequence_name<span class="token punctuation">;</span>  </span>
<span class="line">  </span>
<span class="line">        <span class="token keyword">EXECUTE</span> <span class="token string">&#39;DROP SEQUENCE IF EXISTS &#39;</span> <span class="token operator">||</span> quote_ident<span class="token punctuation">(</span>seq_record<span class="token punctuation">.</span>sequence_name<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&#39; CASCADE;&#39;</span><span class="token punctuation">;</span>  </span>
<span class="line">    <span class="token keyword">END</span> <span class="token keyword">LOOP</span><span class="token punctuation">;</span>  </span>
<span class="line"><span class="token keyword">END</span><span class="token punctuation">;</span>  </span>
<span class="line">$$<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div><h2 id="更改所有serial格式的id为identity" tabindex="-1"><a class="header-anchor" href="#更改所有serial格式的id为identity"><span>更改所有serial格式的id为identity</span></a></h2><div class="language-sql line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"><span class="token keyword">do</span> $$  </span>
<span class="line">    <span class="token keyword">declare</span> counter record<span class="token punctuation">;</span>  </span>
<span class="line"><span class="token keyword">begin</span>  </span>
<span class="line">  <span class="token keyword">for</span> counter <span class="token operator">in</span> <span class="token keyword">SELECT</span> table_name  </span>
<span class="line"><span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span>  <span class="token keyword">where</span> table_schema <span class="token operator">=</span><span class="token string">&#39;public&#39;</span> <span class="token keyword">loop</span>  </span>
<span class="line">     <span class="token keyword">begin</span>  </span>
<span class="line">    raise notice <span class="token string">&#39;counter: %&#39;</span><span class="token punctuation">,</span> counter<span class="token punctuation">.</span>table_name<span class="token punctuation">;</span>  </span>
<span class="line">    <span class="token comment">-- execute  &#39;alter table &#39;||counter.table_name||&#39; alter column id set default null;&#39;;</span></span>
<span class="line"><span class="token comment">--     execute  &#39;alter table &#39;||counter.table_name||&#39; alter column id drop  identity ;&#39;;  </span></span>
<span class="line"><span class="token keyword">execute</span>  <span class="token string">&#39;alter table  &#39;</span><span class="token operator">||</span>counter<span class="token punctuation">.</span>table_name<span class="token operator">||</span><span class="token string">&#39;   alter column id add generated always as identity;&#39;</span><span class="token punctuation">;</span>  </span>
<span class="line">    EXCEPTION <span class="token keyword">WHEN</span> others <span class="token keyword">THEN</span>  </span>
<span class="line">            <span class="token comment">-- 这里处理异常，可以选择记录日志或执行其他操作  </span></span>
<span class="line">            <span class="token comment">-- RAISE NOTICE &#39;Error occurred for i = %&#39;, i;            -- 继续执行下一个循环迭代          </span></span>
<span class="line">              <span class="token keyword">CONTINUE</span><span class="token punctuation">;</span>  </span>
<span class="line">    <span class="token keyword">end</span><span class="token punctuation">;</span>  </span>
<span class="line">  <span class="token keyword">end</span> <span class="token keyword">loop</span><span class="token punctuation">;</span>  </span>
<span class="line"><span class="token keyword">end</span> $$<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="重置identity-id的起始值" tabindex="-1"><a class="header-anchor" href="#重置identity-id的起始值"><span>重置identity id的起始值</span></a></h2><div class="language-sql" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre><code><span class="line"> <span class="token keyword">SELECT</span> pg_get_serial_sequence<span class="token punctuation">(</span><span class="token string">&#39;table_name&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;column_name&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </span>
<span class="line">  </span>
<span class="line"><span class="token keyword">ALTER</span> SEQUENCE teacher_id_seq RESTART <span class="token keyword">WITH</span> <span class="token number">1</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre></div>`,7)]))}const c=n(p,[["render",l]]),r=JSON.parse('{"path":"/java-tutor/orm-tutor/pgsql/pgsql-snippet.html","title":"pgsql的代码片段","lang":"zh-CN","frontmatter":{"description":"pgsql的代码片段 删除所有的sequence 更改所有serial格式的id为identity 重置identity id的起始值","head":[["meta",{"property":"og:url","content":"https://yzqdev.github.io/cs-guide/cs-guide/java-tutor/orm-tutor/pgsql/pgsql-snippet.html"}],["meta",{"property":"og:site_name","content":"cs-guide"}],["meta",{"property":"og:title","content":"pgsql的代码片段"}],["meta",{"property":"og:description","content":"pgsql的代码片段 删除所有的sequence 更改所有serial格式的id为identity 重置identity id的起始值"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-07-09T11:42:51.000Z"}],["meta",{"property":"article:modified_time","content":"2024-07-09T11:42:51.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"pgsql的代码片段\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-07-09T11:42:51.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"yzqdev\\",\\"url\\":\\"http://www.yzqdev.top\\"}]}"]]},"headers":[{"level":2,"title":"删除所有的sequence","slug":"删除所有的sequence","link":"#删除所有的sequence","children":[]},{"level":2,"title":"更改所有serial格式的id为identity","slug":"更改所有serial格式的id为identity","link":"#更改所有serial格式的id为identity","children":[]},{"level":2,"title":"重置identity id的起始值","slug":"重置identity-id的起始值","link":"#重置identity-id的起始值","children":[]}],"git":{"createdTime":1720525371000,"updatedTime":1720525371000,"contributors":[{"name":"yzqdev","username":"yzqdev","email":"yzqdev@outlook.com","commits":1,"url":"https://github.com/yzqdev"}]},"readingTime":{"minutes":0.59,"words":177},"filePathRelative":"java-tutor/orm-tutor/pgsql/pgsql-snippet.md","localizedDate":"2024年7月9日","autoDesc":true}');export{c as comp,r as data};
