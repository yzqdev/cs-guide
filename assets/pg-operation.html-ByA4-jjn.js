import{_ as a,c as e,a as n,o as p}from"./app-B6vXTniy.js";const t={};function o(l,s){return p(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="postgres-操作" tabindex="-1"><a class="header-anchor" href="#postgres-操作"><span>postgres 操作</span></a></h1><h2 id="环境变量" tabindex="-1"><a class="header-anchor" href="#环境变量"><span>环境变量</span></a></h2><ul><li>PG_HOME</li><li>PGDATA</li><li>PGPASSWORD 密码</li></ul><h2 id="删除所有数据" tabindex="-1"><a class="header-anchor" href="#删除所有数据"><span>删除所有数据</span></a></h2><p>先进入数据库</p><div class="language-text" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">psql -U postgres</span>
<span class="line"></span>
<span class="line">然后选择所有的名字</span>
<span class="line"></span>
<span class="line">SELECT datname FROM pg_database;</span>
<span class="line"></span></code></pre></div><h2 id="备份数据" tabindex="-1"><a class="header-anchor" href="#备份数据"><span>备份数据</span></a></h2><p>备份恢复单个数据库</p><div class="language-text" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">$env:PGPASSWORD=&#39;123456&#39;</span>
<span class="line">pg_dump.exe -U postgres blog_ssm &gt; blog_ssm_pg.sql</span>
<span class="line"></span>
<span class="line"># 恢复单个数据库</span>
<span class="line"> $env:PGPASSWORD=&#39;123456&#39;</span>
<span class="line">psql -U postgres -d kuang_bbs -f .\\kuang_pg.sql</span>
<span class="line"> </span>
<span class="line"></span></code></pre></div><p>使用pg_dumpall备份所有</p><div class="language-text" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">$env:PGPASSWORD=&#39;123456&#39;</span>
<span class="line">pg_dumpall.exe -U postgres -E UTF8 -f pg_backup.sql</span>
<span class="line"></span></code></pre></div><p>使用psql -f恢复所有数据</p><div class="language-text" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">$env:PGPASSWORD=&#39;123456&#39;</span>
<span class="line">psql -f ./pg_backup.sql -U postgres</span>
<span class="line"></span></code></pre></div><p>使用powershell配置密码</p><div class="language-text" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">$env:PGPASSWORD=&#39;123456&#39;</span>
<span class="line">pg_dumpall.exe  -U postgres -w -E UTF8 -f pg_backup.sql</span>
<span class="line"></span></code></pre></div><h2 id="postgres升级" tabindex="-1"><a class="header-anchor" href="#postgres升级"><span>postgres升级</span></a></h2><p>1，使用pg_dumpall和psql -f的方式</p><p>这种方式当数据量大的时候性能较低，执行时间长</p><p>2，pg_upgrade</p><div class="language-powershell" data-highlighter="prismjs" data-ext="powershell"><pre><code class="language-powershell"><span class="line"><span class="token variable">$env</span>:PGPASSWORD = <span class="token string">&#39;123456&#39;</span></span>
<span class="line">pg_upgrade <span class="token operator">-</span>b <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\15\\bin&quot;</span> <span class="token operator">-</span>B <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\16\\bin&quot;</span> <span class="token operator">-</span>d <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\15\\data&quot;</span> <span class="token operator">-</span>D <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\16\\data&quot;</span> <span class="token operator">-</span>U postgres</span>
<span class="line"></span></code></pre></div><p>例子</p><div class="language-powershell" data-highlighter="prismjs" data-ext="powershell"><pre><code class="language-powershell"><span class="line"><span class="token variable">$env</span>:PGPASSWORD = <span class="token string">&#39;123456&#39;</span></span>
<span class="line">pg_upgrade <span class="token operator">-</span>b <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\15\\bin&quot;</span> <span class="token operator">-</span>B <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\16\\bin&quot;</span> <span class="token operator">-</span>d <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\15\\data&quot;</span> <span class="token operator">-</span>D <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\16\\data&quot;</span> <span class="token operator">-</span>U postgres</span>
<span class="line"></span></code></pre></div><p>带空格的命令</p><div class="language-powershell" data-highlighter="prismjs" data-ext="powershell"><pre><code class="language-powershell"><span class="line">&amp; pg_upgrade <span class="token operator">-</span>b <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\15\\bin&quot;</span> <span class="token operator">-</span>B <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\16\\bin&quot;</span> <span class="token operator">-</span>d <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\15\\data&quot;</span> <span class="token operator">-</span>D <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\16\\data&quot;</span> <span class="token operator">-</span>U postgres</span>
<span class="line"></span></code></pre></div><h2 id="windows出问题" tabindex="-1"><a class="header-anchor" href="#windows出问题"><span>windows出问题</span></a></h2><p>见 https://www.postgresql.org/docs/current/pgupgrade.html</p><p>如果文件夹不显示安全选项卡 就命令行<code>gpedit.msc</code>,点击【用户配置】-【管理模版】-【Windows组件】-【Windows资源管理器】-右侧找到【删除&quot;安全&quot;选项卡,设置为禁用</p><p>要先创建postgres的data</p><div class="language-powershell" data-highlighter="prismjs" data-ext="powershell"><pre><code class="language-powershell"><span class="line"> net user postgres 123456 <span class="token operator">/</span>add</span>
<span class="line"></span>
<span class="line">RUNAS <span class="token operator">/</span>USER:postgres <span class="token string">&quot;CMD.EXE&quot;</span></span>
<span class="line"><span class="token function">SET</span> PATH=<span class="token operator">%</span>PATH%<span class="token punctuation">;</span>d:\\Program Files\\PostgreSQL\\15\\bin<span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">initdb <span class="token operator">-</span>D <span class="token string">&quot;D:\\Program Files\\PostgreSQL\\15\\data&quot;</span> <span class="token operator">-</span>U postgres</span>
<span class="line"></span></code></pre></div>`,29)])])}const i=a(t,[["render",o]]),g=JSON.parse('{"path":"/java-tutor/orm-tutor/pgsql/pg-operation.html","title":"postgres 操作","lang":"zh-CN","frontmatter":{"description":"postgres 操作 环境变量 PG_HOME PGDATA PGPASSWORD 密码 删除所有数据 先进入数据库 备份数据 备份恢复单个数据库 使用pg_dumpall备份所有 使用psql -f恢复所有数据 使用powershell配置密码 postgres升级 1，使用pg_dumpall和psql -f的方式 这种方式当数据量大的时候性能较...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"postgres 操作\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-06-24T22:53:46.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"yzqdev\\",\\"url\\":\\"http://www.yzqdev.top\\"}]}"],["meta",{"property":"og:url","content":"https://yzqdev.github.io/cs-guide/cs-guide/java-tutor/orm-tutor/pgsql/pg-operation.html"}],["meta",{"property":"og:site_name","content":"cs-guide"}],["meta",{"property":"og:title","content":"postgres 操作"}],["meta",{"property":"og:description","content":"postgres 操作 环境变量 PG_HOME PGDATA PGPASSWORD 密码 删除所有数据 先进入数据库 备份数据 备份恢复单个数据库 使用pg_dumpall备份所有 使用psql -f恢复所有数据 使用powershell配置密码 postgres升级 1，使用pg_dumpall和psql -f的方式 这种方式当数据量大的时候性能较..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-06-24T22:53:46.000Z"}],["meta",{"property":"article:modified_time","content":"2024-06-24T22:53:46.000Z"}]]},"git":{"createdTime":1695234758000,"updatedTime":1719269626000,"contributors":[{"name":"yzqdev","username":"yzqdev","email":"yzqdev@outlook.com","commits":5,"url":"https://github.com/yzqdev"}]},"readingTime":{"minutes":1.25,"words":374},"filePathRelative":"java-tutor/orm-tutor/pgsql/pg-operation.md","autoDesc":true}');export{i as comp,g as data};
